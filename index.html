<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>Lotto Checker</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <h1>ðŸ“¸ Lotto Checker</h1>
  <form id="lotto-form">
    <label for="image">Bild auswÃ¤hlen:</label>
    <input type="file" id="image" accept="image/*" required><br><br>

    <label for="numbers">Gezogene Zahlen (z.B. 3,7,12...):</label>
    <input type="text" id="numbers" placeholder="z.B. 4,8,15,16,23,42" required><br><br>

    <button type="submit">Senden</button>
  </form>

  <div id="result">
    <h2>Ergebnis:</h2>
    <img id="result-image" alt="Ergebnisbild wird hier angezeigt...">
    <pre id="json-output"></pre>
  </div>

  <script>
    document.getElementById('lotto-form').addEventListener('submit', async function (e) {
      e.preventDefault();

      const form = new FormData();
      const imageInput = document.getElementById('image');
      const numbers = document.getElementById('numbers').value;

      form.append('image', imageInput.files[0]);
      form.append('numbers', numbers);

      const response = await fetch('https://lotto-checker-server.onrender.com/check_lotto', {
        method: 'POST',
        body: form
      });

      const contentType = response.headers.get('content-type');

      if (contentType && contentType.startsWith('multipart/mixed')) {
        const text = await response.text();
        const boundary = contentType.split('boundary=')[1];
        const parts = text.split('--' + boundary);

        const jsonPart = parts.find(part => part.includes('application/json'));
        const imagePart = parts.find(part => part.includes('image/jpeg'));

        // JSON anzeigen
        const jsonMatch = jsonPart.match(/{[\s\S]*}/);
        if (jsonMatch) {
          const json = JSON.parse(jsonMatch[0]);
          document.getElementById('json-output').textContent = JSON.stringify(json, null, 2);
        }

        // Bild anzeigen
        const imageBase64 = imagePart.split('\r\n\r\n')[1].trim();
        const blob = new Blob([Uint8Array.from(atob(imageBase64), c => c.charCodeAt(0))], { type: 'image/jpeg' });
        const imgURL = URL.createObjectURL(blob);
        document.getElementById('result-image').src = imgURL;
      } else {
        alert('Fehler bei der Antwort vom Server');
      }
    });
  </script>
</body>
</html>
